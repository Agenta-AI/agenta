apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "agenta-oss.fullname" . }}-test-connection"
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "agenta-oss.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  restartPolicy: Never
  containers:
    - name: wget
      image: curlimages/curl:latest
      command: ['sh', '-c']
      args:
        - |
          set -e
          echo "Testing API health endpoint..."
          curl -f http://{{ include "agenta-oss.fullname" . }}-api:8000/api/health
          echo "API health check passed!"
          
          echo "Testing SuperTokens hello endpoint..."
          curl -f http://{{ include "agenta-oss.fullname" . }}-supertokens:3567/hello
          echo "SuperTokens hello check passed!"
          
          echo "Testing Web frontend..."
          curl -f http://{{ include "agenta-oss.fullname" . }}-web:3000/
          echo "Web frontend check passed!"
          
          echo "All connection tests passed!"
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 50m
          memory: 64Mi