name: agenta-gh-local-override

services:
  web:
    labels:
      - "traefik.http.routers.web.rule=PathPrefix(`/`)"
      - "traefik.http.routers.web.entrypoints=web"
      - "traefik.http.services.web.loadbalancer.server.port=3000"

  api:
    labels:
      - "traefik.http.routers.api.rule=PathPrefix(`/api/`)"
      - "traefik.http.routers.api.entrypoints=web"
      - "traefik.http.middlewares.api-strip.stripprefix.prefixes=/api"
      - "traefik.http.middlewares.api-strip.stripprefix.forceslash=true"
      - "traefik.http.routers.api.middlewares=api-strip"
      - "traefik.http.services.api.loadbalancer.server.port=8000"
      - "traefik.http.routers.api.service=api"

  services:
    volumes: []
    labels:
      - "traefik.http.routers.services.rule=PathPrefix(`/services/`)"
      - "traefik.http.routers.services.entrypoints=web"
      - "traefik.http.middlewares.services-strip.stripprefix.prefixes=/services"
      - "traefik.http.middlewares.services-strip.stripprefix.forceslash=true"
      - "traefik.http.routers.services.middlewares=services-strip"
      - "traefik.http.services.services.loadbalancer.server.port=80"
      - "traefik.http.routers.services.service=services"

  traefik:
    command:
      - --api.insecure=true
      - --providers.docker=true
      - --providers.docker.exposedbydefault=true
      - --entrypoints.web.address=:80
    ports:
      - "${TRAEFIK_PORT:-80}:80"
      - "${TRAEFIK_UI_PORT:-8080}:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
