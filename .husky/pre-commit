# Check if there are staged changes in the frontend directory
if git diff --cached --name-only | grep -q '^agenta-web/'; then
    echo 'ğŸ” Changes detected in the agenta-web directory. Running checks...'

    # Navigate to the frontend directory
    cd agenta-web || exit

    # Run ESLint check
    if ! npm run lint; then
        echo 'âŒ ESLint issues detected. Please fix them before committing.'
        exit 1
    else
        echo 'âœ… ESLint check passed.'
    fi

    # Run TypeScript type check
    if ! npm run types:check; then
        echo 'âŒ TypeScript type errors detected. Please fix them before committing.'
        exit 1
    else
        echo 'âœ… TypeScript type check passed.'
    fi

    # Run Prettier check
    if ! npm run format; then
        echo 'âš ï¸ Formatting issues detected. Running Prettier to fix them...'
        npm run format-fix

        # Stage the fixed files
        git add .

        echo 'âœ… Formatting issues fixed and changes staged. Proceeding with further checks...'
    else
        echo 'âœ… Prettier check passed.'
    fi

    echo 'ğŸ‰ All checks passed. Ready to commit!'
else
    echo 'âœ… No changes in the agenta-web directory. Skipping frontend checks.'
fi

# Check for changes in backend directory
if git diff --cached --name-only | grep -q '^agenta-backend/'; then
    echo 'ğŸ” Changes detected in the backend directory. Running checks...'

    # Navigate to the backend directory
    cd agenta-backend || exit

    # Run pylint for linting
    echo 'ğŸ” Running pylint...'
    if ! pylint $(git diff --cached --name-only | grep '\.py$'); then
        echo 'âŒ pylint issues detected. Please fix them before committing.'
        exit 1
    else
        echo 'âœ… pylint check passed.'
    fi

    # Run black for formatting
    echo 'ğŸ” Running black...'
    if ! black --check .; then
        echo 'âš ï¸ Formatting issues detected. Running black to fix them...'
        black .

        # Stage the fixed files
        git add .

        echo 'âœ… Formatting issues fixed and changes staged. Proceeding with further checks...'
    else
        echo 'âœ… black formatting check passed.'
    fi

    echo 'ğŸ‰ Backend checks passed. Ready to commit!'
else
    echo 'âœ… No changes in the backend directory. Skipping backend checks.'
fi