---
title: "Managing Testsets"
sidebar_label: "Managing Testsets"
description: "Learn how to create, list, and retrieve testsets using the Agenta SDK or API"
sidebar_position: 2
---

import GoogleColabButton from "@site/src/components/GoogleColabButton";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

This guide covers how to create, list, and retrieve testsets using the Agenta SDK or REST API.

<GoogleColabButton notebookPath="examples/jupyter/evaluation/testset-management.ipynb">
  Open in Google Colaboratory
</GoogleColabButton>

## Creating a Testset

Use `ag.testsets.acreate()` to create a new testset with data:

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

# Create a testset with simple data
testset = await ag.testsets.acreate(
    data=[
        {"country": "Germany", "capital": "Berlin"},
        {"country": "France", "capital": "Paris"},
        {"country": "Spain", "capital": "Madrid"}
    ],
    name="Country Capitals",
)

testset_id = testset.testset_id or testset.id
print(f"Testset ID: {testset_id}")
print(f"Revision ID: {testset.id}")
print(f"Name: {testset.name}")
print(f"Slug: {testset.slug}")
```

  </TabItem>
  <TabItem value="REST API">

```bash
curl -X POST "https://cloud.agenta.ai/api/preview/simple/testsets/" \
  -H "Content-Type: application/json" \
  -H "Authorization: ApiKey YOUR_API_KEY" \
  -d '{
    "testset": {
      "name": "Country Capitals",
      "slug": "country-capitals",
      "data": {
        "testcases": [
          {"data": {"country": "Germany", "capital": "Berlin"}},
          {"data": {"country": "France", "capital": "Paris"}},
          {"data": {"country": "Spain", "capital": "Madrid"}}
        ]
      }
    }
  }'
```

  </TabItem>
</Tabs>

**Parameters:**
- `data`: A list of dictionaries containing your test data. Each dictionary represents one testcase.
- `name`: The name of your testset.

**Returns:** A `TestsetRevision` object containing:
- `id`: The UUID of the created testset revision
- `testset_id`: The parent testset UUID (stable across revisions)
- `name`: The testset name
- `slug`: The revision slug
- `version`: The revision version string (e.g. "1")
- `data`: The test data (with `testcases` structure)

**Sample Output:**

```python
{
    "id": "01963413-3d39-7650-80ce-3ad5d688da6c",
    "name": "Country Capitals",
    "slug": "3ad5d688da6c",
    "data": {
        "testcases": [
            {"data": {"country": "Germany", "capital": "Berlin"}},
            {"data": {"country": "France", "capital": "Paris"}},
            {"data": {"country": "Spain", "capital": "Madrid"}}
        ]
    }
}
```

:::tip
The `data` parameter accepts a simple list of dictionaries. The SDK automatically converts this to the structured `TestsetRevisionData` format internally.
:::

## Upserting a Testset

Use `ag.testsets.aupsert()` to create a new testset or replace an existing one. This function performs a full replacement of the testset data.

**How it works:**

1. The function searches for an existing testset by `testset_id` (if provided) or by `name`
2. If found, it **replaces all testcases** with the new data you provide
3. If not found, it creates a new testset

:::warning Full replacement
The upsert operation replaces the entire testset. All existing testcases are removed and replaced with the new data. There is no merge or append behavior.
:::

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

# First call: creates a new testset with 3 testcases
testset = await ag.testsets.aupsert(
    name="Country Capitals",
    data=[
        {"country": "Germany", "capital": "Berlin"},
        {"country": "France", "capital": "Paris"},
        {"country": "Spain", "capital": "Madrid"},
    ],
)

# Second call: replaces ALL testcases with these 4
# The original 3 testcases are removed
testset = await ag.testsets.aupsert(
    name="Country Capitals",
    data=[
        {"country": "Germany", "capital": "Berlin"},
        {"country": "France", "capital": "Paris"},
        {"country": "Spain", "capital": "Madrid"},
        {"country": "Italy", "capital": "Rome"},
    ],
)

testset_id = testset.testset_id or testset.id
print(f"Testset ID: {testset_id}")
print(f"Revision ID: {testset.id}")
```

  </TabItem>
  <TabItem value="REST API">

To update an existing testset, use the PUT endpoint with the testset ID. This replaces all existing testcases:

```bash
curl -X PUT "https://cloud.agenta.ai/api/preview/simple/testsets/{testset_id}" \
  -H "Content-Type: application/json" \
  -H "Authorization: ApiKey YOUR_API_KEY" \
  -d '{
    "testset": {
      "id": "YOUR_TESTSET_ID",
      "name": "Country Capitals",
      "data": {
        "testcases": [
          {"data": {"country": "Germany", "capital": "Berlin"}},
          {"data": {"country": "France", "capital": "Paris"}},
          {"data": {"country": "Spain", "capital": "Madrid"}},
          {"data": {"country": "Italy", "capital": "Rome"}}
        ]
      }
    }
  }'
```

  </TabItem>
</Tabs>

**Parameters:**
- `name`: The name of your testset. Used to find an existing testset if `testset_id` is not provided.
- `data` (required): A list of dictionaries containing your test data. This replaces all existing testcases.
- `testset_id` (optional): If provided, updates the testset with this specific ID directly.

**Returns:** A `TestsetRevision` object with the created or updated testset.

:::tip When to use each method
- **`aupsert()`**: Use when you want to synchronize a testset to match your data exactly. Ideal for CI/CD pipelines where you regenerate test data and want to keep the testset in sync.
- **`acreate()`**: Use when you want to create a new testset every time, regardless of whether one with the same name exists.
- **`aedit()`**: Use when you have the testset ID and want to replace its contents.
:::

## Listing Testsets

To list all testsets in your project, use `ag.testsets.alist()`:

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

# List all testsets
testsets = await ag.testsets.alist()

print(f"Found {len(testsets)} testsets:")
for testset in testsets:
    testset_id = testset.testset_id or testset.id
    print(f"  - {testset.name} (testset_id: {testset_id})")
```

  </TabItem>
  <TabItem value="REST API">

```bash
curl -X POST "https://cloud.agenta.ai/api/preview/simple/testsets/query" \
  -H "Content-Type: application/json" \
  -H "Authorization: ApiKey YOUR_API_KEY" \
  -d '{}'
```

  </TabItem>
</Tabs>

**Parameters:** None required.

**Returns:** A list of `TestsetRevision` objects. For each item:
- `id`: The latest revision UUID
- `testset_id`: The parent testset UUID
- `name`: The testset name
- `slug`: The revision slug
- Additional metadata fields

**Sample Output:**

```python
[
    {
        "id": "01963413-3d39-7650-80ce-3ad5d688da6c",
        "name": "Country Capitals",
        "slug": "country-capitals"
    },
    {
        "id": "01963520-4e4a-8761-91df-4be6e799eb7d",
        "name": "Math Problems",
        "slug": "math-problems"
    }
]
```

## Retrieving a Testset by ID

To retrieve a specific testset by its ID, use `ag.testsets.aretrieve()`:

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

# Retrieve a specific testset (using the testset_id from creation)
testset = await ag.testsets.aretrieve(testset_id=testset_id)

if testset:
    print(f"Retrieved testset: {testset.id}")
    print(f"Testcases count: {len(testset.data.testcases) if testset.data and testset.data.testcases else 0}")
else:
    print("Testset not found")
```

  </TabItem>
  <TabItem value="REST API">

```bash
curl -X GET "https://cloud.agenta.ai/api/preview/simple/testsets/{testset_id}" \
  -H "Authorization: ApiKey YOUR_API_KEY"
```

  </TabItem>
</Tabs>

**Parameters:**
- `testset_id`: The UUID of the testset to retrieve

**Returns:** A `TestsetRevision` object (or `None` if not found) containing:
- `id`: The testset revision UUID
- `testset_id`: The parent testset UUID
- `slug`: The revision slug
- `version`: The revision version number
- `data`: The `TestsetRevisionData` with all testcases

**Sample Output:**

```python
{
    "id": "01963413-3d39-7650-80ce-3ad5d688da6c",
    "testset_id": "01963413-3d39-7650-80ce-3ad5d688da6c",
    "slug": "3ad5d688da6c",
    "version": "1",
    "data": {
        "testcases": [
            {"data": {"country": "Germany", "capital": "Berlin"}},
            {"data": {"country": "France", "capital": "Paris"}},
            {"data": {"country": "Spain", "capital": "Madrid"}}
        ]
    }
}
```

:::info
Testsets are versioned. Each update via `ag.testsets.aedit()` or `ag.testsets.aupsert()` creates a new `TestsetRevision`, while the parent `testset_id` stays the same.
:::

## Retrieving a Testset by Name

You can find a testset by name by filtering the results from the query endpoint:

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

async def get_testset_by_name(name: str):
    """Helper function to find a testset by name."""
    testsets = await ag.testsets.alist()

    if not testsets:
        return None

    for testset in testsets:
        if testset.name == name:
            return testset

    return None

# Usage
testset = await get_testset_by_name("Country Capitals")

if testset:
    testset_id = testset.testset_id or testset.id
    print(f"Found testset: {testset.name} (testset_id: {testset_id}, revision_id: {testset.id})")
else:
    print("Testset not found")
```

  </TabItem>
  <TabItem value="REST API">

```bash
curl -X POST "https://cloud.agenta.ai/api/preview/simple/testsets/query" \
  -H "Content-Type: application/json" \
  -H "Authorization: ApiKey YOUR_API_KEY" \
  -d '{
    "testset": {
      "name": "Country Capitals"
    }
  }'
```

  </TabItem>
</Tabs>

:::tip Helper Pattern
This pattern shows how you can implement your own helper functions to filter and find testsets based on custom criteria. You can extend this to search by tags or other metadata fields.
:::

## Working with Test Data

Once you have a testset, you can access the testcases within it:

<Tabs>
  <TabItem value="Python SDK">

```python
import agenta as ag

ag.init()

# Retrieve a testset
testset = await ag.testsets.aretrieve(testset_id=testset_id)

# Access testcases
if testset and testset.data and testset.data.testcases:
    for testcase in testset.data.testcases:
        print(f"Testcase: {testcase.data}")
        # Use testcase.data in your evaluation
```

  </TabItem>
  <TabItem value="REST API">

When you retrieve a testset via the API, the response includes the testcases in the `data.testcases` array:

```json
{
  "testset": {
    "id": "01963413-3d39-7650-80ce-3ad5d688da6c",
    "name": "Country Capitals",
    "data": {
      "testcases": [
        {
          "id": "bf2de79d-bcd0-569e-92aa-735bbdd0b447",
          "data": {"country": "Germany", "capital": "Berlin"}
        },
        {
          "id": "f54345c8-939c-5d03-9950-b62b876b10bd",
          "data": {"country": "France", "capital": "Paris"}
        }
      ]
    }
  }
}
```

  </TabItem>
</Tabs>

Each testcase contains a `data` field with the dictionary you provided during creation. You can use these testcases directly in your evaluations.

